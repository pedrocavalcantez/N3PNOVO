{% extends "base.html" %} {% from "macros/forms.html" import render_form %} {%
block title %}Perfil - N3P{% endblock %} {% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <!-- User Information -->
    <div class="col-md-8">
      <div class="card profile-card mb-4">
        <div class="card-header bg-white border-bottom-0 py-3">
          <h4 class="mb-0">
            <i class="fas fa-user-circle me-2"></i>Informações Pessoais
          </h4>
        </div>
        <div class="card-body">
          {{ render_form(form, url_for('auth.profile'), submit_text='Atualizar
          Perfil') }}
        </div>
      </div>
    </div>

    <!-- Nutritional Goals -->
    <div class="col-md-4">
      <div class="card goals-card">
        <div class="card-header bg-white border-bottom-0 py-3">
          <h4 class="mb-0">
            <i class="fas fa-bullseye me-2"></i>Metas Nutricionais
          </h4>
        </div>
        <div class="card-body">
          <div class="calories-goal mb-4">
            <h5 class="text-muted mb-2">Calorias Diárias</h5>
            <h2 class="display-6 mb-2">
              <span>{{ "%.1f"|format(user_goals.calories) }}</span>
              <small class="text-muted">kcal</small>
            </h2>
            <div class="goal-badge">
              <i class="fas fa-flag me-1"></i>
              {{ user.get_objetivo_display() }}
            </div>
          </div>

          <div class="macros-distribution">
            <h6 class="text-muted mb-3">Distribuição de Macronutrientes</h6>

            <!-- Progress Bars -->
            <div class="macro-bars mb-4">
              <div class="macro-bar mb-3">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="text-success"
                    ><i class="fas fa-circle me-1"></i>Proteínas</span
                  >
                  <span class="fw-bold"
                    >{{ "%.1f"|format(user_goals.proteins) }}g</span
                  >
                </div>
                <div class="progress">
                  <div
                    class="progress-bar bg-success"
                    role="progressbar"
                    style="width: 30%"
                    aria-valuenow="30"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>

              <div class="macro-bar mb-3">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="text-warning"
                    ><i class="fas fa-circle me-1"></i>Carboidratos</span
                  >
                  <span class="fw-bold"
                    >{{ "%.1f"|format(user_goals.carbs) }}g</span
                  >
                </div>
                <div class="progress">
                  <div
                    class="progress-bar bg-warning"
                    role="progressbar"
                    style="width: 45%"
                    aria-valuenow="45"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>

              <div class="macro-bar">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="text-danger"
                    ><i class="fas fa-circle me-1"></i>Gorduras</span
                  >
                  <span class="fw-bold"
                    >{{ "%.1f"|format(user_goals.fats) }}g</span
                  >
                </div>
                <div class="progress">
                  <div
                    class="progress-bar bg-danger"
                    role="progressbar"
                    style="width: 25%"
                    aria-valuenow="25"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/auth.css') }}"
/>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    function formatDecimalInput(input) {
      if (input.value && !isNaN(input.value)) {
        const value = parseFloat(input.value);
        if (value !== parseFloat(input.dataset.lastValue)) {
          input.value = value.toFixed(1);
          input.dataset.lastValue = input.value;

          // Add visual feedback
          input.style.transition = "all 0.3s ease";
          input.style.backgroundColor = "rgba(180, 217, 87, 0.1)";
          setTimeout(() => {
            input.style.backgroundColor = "";
          }, 500);
        }
      }
    }

    // Format height input
    const alturaInput = document.querySelector('input[name="altura"]');
    if (alturaInput) {
      alturaInput.step = "0.1";
      alturaInput.addEventListener("blur", function () {
        formatDecimalInput(this);
      });
      alturaInput.addEventListener("input", function (e) {
        this.value = this.value.replace(/[^\d.]/g, "");
        const parts = this.value.split(".");
        if (parts.length > 2) {
          this.value = parts[0] + "." + parts.slice(1).join("");
        }
      });
    }

    // Format weight input
    const pesoInput = document.querySelector('input[name="peso"]');
    if (pesoInput) {
      pesoInput.step = "0.1";
      pesoInput.addEventListener("blur", function () {
        formatDecimalInput(this);
      });
      pesoInput.addEventListener("input", function (e) {
        this.value = this.value.replace(/[^\d.]/g, "");
        const parts = this.value.split(".");
        if (parts.length > 2) {
          this.value = parts[0] + "." + parts.slice(1).join("");
        }
      });
    }

    // Animate progress bars on load
    document.querySelectorAll(".progress-bar").forEach((bar) => {
      const width = bar.style.width;
      bar.style.width = "0%";
      setTimeout(() => {
        bar.style.width = width;
      }, 500);
    });
  });
</script>
{% endblock %}
